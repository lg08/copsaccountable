{% extends "posts/post_base.html" %}

{% block prepost %}
    {% load bootstrap4 %}
{% endblock %}

{% block post_content %}

    <div class="container">
        <div class="card bg-light w-100">
            <div class="card-header"><h2>{{ post.title }}</h2></div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12">
                        {% if post.video %}
                            <video width="100%"  controls>
                                <source src="{{ post.video.url }}" type="video/mp4">
                                <!-- <source src="movie.ogg" type="video/ogg"> -->
                                Your browser does not support the video tag.
                            </video>
                        {% endif %}
                    </div>
                    <div class="col-12">
                        <h3>Message: </h3>
                        <p>{{ post.message }}</p>
                    </div>
                    <div class="col-12">
                        <h3>Time Info:</h3>
                        <p>{{ post.time_information }}</p>
                    </div>
                    <div class="col-12">
                        <h3>Place Info:</h3>
                        <p>{{ post.location_information }}</p>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class="row justify-content-center">
                    <div class="col">
                        {% if user.is_authenticated %}
                            <form action="{% url 'posts:upvote_post' pk=post.pk %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" name="post_id" value="{{ post.id }}" class="btn btn-primary">Upvote</button>
                            </form>
                        {% else %}
                            <form action="{% url 'accounts:login' %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary">DownVote</button>
                            </form>
                        {% endif %}
                        <p>upvotes: {{ total_upvotes }}</p>
                    </div>
                    <div class="col">
                        {% if user.is_authenticated %}
                            <form action="{% url 'posts:downvote_post' pk=post.pk %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" name="post_id" value="{{ post.id }}" class="btn btn-primary">DownVote</button>
                            </form>
                        {% else %}
                            <form action="{% url 'accounts:login' %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary">DownVote</button>
                            </form>
                        {% endif %}
                        <p>downvotes: {{ total_downvotes }}</p>
                    </div>
                    <div class="col">
                        {% if user.is_authenticated %}
                            <button class="btn btn-primary" type="button" data-toggle="collapse" data-target=".multi-collapse" aria-expanded="false" aria-controls="multiCollapseExample1 multiCollapseExample2">Reply to Post</button>
                        {% else %}
                            <form action="{% url 'accounts:login' %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary">Reply to Post</button>
                            </form>
                        {% endif %}
                    </div>
                    {% if current_user == post.user %}
                        <div class="col">

                            <form action="{% url 'posts:delete' pk=post.pk %}">
                                {% csrf_token %}
                                <button class="btn btn-warning">Delete Post</button>
                            </form>
                        </div>

                    {% endif %}
                </div>
                </div>
        </div>
        <!-- Comment Form -->
        <p>
            <form action="{% url 'posts:create_comment' postpk=post.pk commentpk=post.pk subcomment=0 %}" method="POST" class="collapse multi-collapse">
                {% bootstrap_form comment_form %}
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </p>                        
    </div>                      <!--container-->
    
    
    
    

    <p>
        {% if this_person_upvoted_it >= 1 %}
            <!-- <p1>you already upvoted this</p1> -->
        {% else %}
            <!-- <p>you have not upvoted this yet</p> -->
        {% endif %}

        {% if this_person_downvoted_it >= 1 %}
            <!-- <p1>you already downvoted this</p1> -->
        {% else %}
            <!-- <p>you have not downvoted this yet</p> -->
        {% endif %}
    </p>



{% endblock %}

{% block post_post %}

    <!-- Comments -->
    
    <div class="container">
        <h1>Comments:</h1>

        {% for comment in post.post_comments.all %}

            {% if comment.comment %} <!--if the comment is a subcomment-->
            {% else %}
                <!-- loops through all comments -->
                <div class="media border-left border-dark rounded my-3 px-3">
                    <div class="media-body">
                        <div class="row">
                            <div class="col">
                                <div class="col-12">
                                    <p>{{ comment.message }}</p>                                
                                </div>
                                <div class="col-12">
                                    <p>by: {{ comment.user }}</p>                                
                                </div>
                                <div class="col-12">
                                    <p>
                                        <time class="card-text">at: {{ comment.created_at }}</time>
                                    </p>        
                                </div>    
                            </div>
                            <div class="col">
                                <button class="btn btn-primary" type="button" data-toggle="collapse" data-target=".form-collapse-{{ comment.pk }}" aria-expanded="false" aria-controls="multiCollapseExample1 multiCollapseExample2">Reply to Post</button>
                            </div>
                        </div>
                        

                        <!-- displays the second-level subcomments -->
                        {% for subcomment in comment.comment_comments.all %}
                            {% include 'posts/comment.html' %}
                        {% endfor %}
                        
                    </div>
                </div>
                
            {% endif %}
            <p> <!--individual comment forms-->
                <form action="{% url 'posts:create_comment' postpk=post.pk commentpk=post.pk subcomment=0 %}" method="POST" class="collapse form-collapse-{{ comment.pk }}">
                    {% bootstrap_form comment_form %}
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </p>                                        
        {% endfor %}

    </div>



{% endblock %}
